<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Runtime.zyjeski.com - Debug Consciousness</title>
    <meta name="description" content="Interactive fiction platform where readers debug consciousness as executable code">
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/terminal.css">
    <link rel="stylesheet" href="/css/monitor.css">
    <link rel="stylesheet" href="/css/debug.css">
    <link rel="stylesheet" href="/css/enhanced.css">
    <link rel="stylesheet" href="/css/context-menu.css">
    <link rel="stylesheet" href="/css/help.css">
    <link rel="stylesheet" href="/css/intervention.css">

    <!-- Component CSS Files -->
    <link rel="stylesheet" href="/css/components/process-list.css">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;600&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Templates for monitor interface -->
    <template id="resourceMeterTemplate">
        <div class="resource-meter">
            <div class="meter-label">
                <span class="meter-name"></span>
                <span class="meter-value"></span>
            </div>
            <div class="meter-bar">
                <div class="meter-fill"></div>
            </div>
        </div>
    </template>

    <template id="processRowTemplate">
        <tr class="process-row">
            <td class="process-pid"></td>
            <td class="process-name"></td>
            <td class="process-status"></td>
            <td class="process-cpu"></td>
            <td class="process-memory"></td>
            <td>
                <button class="action-btn kill-btn">Kill</button>
            </td>
        </tr>
    </template>

    <template id="memoryBlockTemplate">
        <div class="memory-block">
            <div class="memory-block-id"></div>
            <div class="memory-block-size"></div>
        </div>
    </template>

    <template id="errorEntryTemplate">
        <div class="error-entry">
            <div class="error-header">
                <span class="error-timestamp"></span>
                <span class="error-severity"></span>
            </div>
            <div class="error-description"></div>
        </div>
    </template>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="brand-text">runtime.zyjeski.com</span>
                <span class="brand-subtitle">consciousness debugger</span>
            </div>
            <div class="nav-links">
                <a href="#home" class="nav-link active" data-section="home">Home</a>
                <a href="#terminal" class="nav-link" data-section="terminal">Terminal</a>
                <a href="#monitor" class="nav-link" data-section="monitor">Monitor</a>
                <a href="#debugger" class="nav-link" data-section="debugger">Debugger</a>
                <a href="/component-showcase.html" class="nav-link">Components</a>
            </div>
            <div class="nav-status">
                <div class="connection-status" id="connectionStatus">
                    <span class="status-dot"></span>
                    <span class="status-text">Disconnected</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Home Section -->
        <section id="home" class="section active">
            <div class="hero-container">
                <div class="hero-content">
                    <h1 class="hero-title">
                        Debug <span class="highlight">Consciousness</span>
                        <br>as <span class="highlight">Code</span>
                    </h1>
                    <p class="hero-description">
                        Interactive fiction where characters exist as running processes with observable mental states. 
                        Debug memory leaks of grief, infinite loops of anxiety, and thread starvation of neglected relationships.
                    </p>
                    <div class="hero-actions">
                        <button class="btn btn-primary" id="startDebugging">Start Debugging</button>
                        <button class="btn btn-primary" onclick="window.onboardingSystem?.restart()">
                            ðŸ§  Start Tutorial
                        </button>
                    </div>
                </div>
                <div class="hero-visual">
                    <div class="consciousness-preview" id="consciousnessPreview">
                        <div class="process-list">
                            <div class="process-item">
                                <span class="process-name">Grief_Manager.exe</span>
                                <span class="process-status error">Memory Leak</span>
                                <span class="process-usage">847MB</span>
                            </div>
                            <div class="process-item">
                                <span class="process-name">Temporal_Sync.dll</span>
                                <span class="process-status warning">Desync Error</span>
                                <span class="process-usage">23% CPU</span>
                            </div>
                            <div class="process-item">
                                <span class="process-name">Search_Protocol.exe</span>
                                <span class="process-status error">Infinite Loop</span>
                                <span class="process-usage">89% CPU</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Character Selection -->
            <div class="character-section">
                <h2 class="section-title">Available Consciousness Profiles</h2>
                <div class="character-grid" id="characterGrid">
                    <!-- Characters will be loaded dynamically -->
                </div>
            </div>

            <!-- Concept Explanation -->
            <div class="concept-section">
                <h2 class="section-title">Consciousness as Code</h2>
                <div class="concept-grid">
                    <div class="concept-item">
                        <div class="concept-icon">ðŸ§ </div>
                        <h3>Memory Leaks</h3>
                        <p>Emotional attachments that consume increasing mental resources over time</p>
                    </div>
                    <div class="concept-item">
                        <div class="concept-icon">ðŸ”„</div>
                        <h3>Infinite Loops</h3>
                        <p>Anxiety and obsessive thoughts that trap consciousness in repetitive cycles</p>
                    </div>
                    <div class="concept-item">
                        <div class="concept-icon">ðŸ§µ</div>
                        <h3>Thread Starvation</h3>
                        <p>Neglected relationships and aspects of life that lack processing time</p>
                    </div>
                    <div class="concept-item">
                        <div class="concept-icon">âš¡</div>
                        <h3>CPU Spikes</h3>
                        <p>Overwhelming emotions that consume all available mental processing power</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Terminal Section -->
        <section id="terminal" class="section">
            <div class="terminal-container">
                <div class="terminal-header">
                    <div class="terminal-controls">
                        <span class="control-dot red"></span>
                        <span class="control-dot yellow"></span>
                        <span class="control-dot green"></span>
                    </div>
                    <div class="terminal-title">Consciousness Debug Terminal</div>
                    <div class="terminal-actions">
                        <button class="btn btn-small" id="clearTerminal">Clear</button>
                    </div>
                </div>
                <div class="terminal-body">
                    <div class="terminal-output" id="terminalOutput"></div>
                    <div class="terminal-input-line">
                        <span class="terminal-prompt">debug@consciousness:~$ </span>
                        <input type="text" class="terminal-input" id="terminalInput" placeholder="Enter command (ps, top, kill, monitor, attach)">
                    </div>
                </div>
            </div>
        </section>

        <!-- Monitor Section -->
        <section id="monitor" class="section">
            <div class="monitor-container">
                <div class="monitor-header">
                    <h2>Consciousness Monitor</h2>
                    <div class="monitor-controls">
                        <div class="connection-status disconnected" id="connectionStatus" style="display: none;">No Consciousness Connected</div>
                        <select id="characterSelect" class="character-selector" style="display: none;">
                            <option value="">Select Character</option>
                            <option value="alexander-kane">Alexander Kane</option>
                        </select>
                        
                        <!-- Updated monitoring toggle button -->
                        <button class="btn btn-primary" id="toggleMonitoring" disabled style="display: none;">
                            <span class="btn-icon">â–¶</span>
                            <span class="btn-text">Start Monitoring</span>
                        </button>
                        
                        <button class="btn btn-small" id="refreshMonitor" disabled>
                            <span class="btn-icon">â†»</span>
                            Refresh
                        </button>

                        <button class="btn btn-small" id="testMemoryBtn" onclick="injectTestMemoryData()">
                            <span class="btn-icon">ðŸ§ </span>
                            Test Memory
                        </button>
                    </div>
                </div>
                <div class="monitor-grid">
                    <div class="monitor-panel">
                        <h3>System Resources</h3>
                        <div class="resource-meters" id="resourceMeters">
                            <!-- Resource meters will be populated dynamically -->
                            <div class="empty-state">Waiting for data...</div>
                        </div>
                    </div>
                    <div class="monitor-panel">
                        <h3>Active Processes</h3>
                        <div class="process-table" id="processTable">
                            <!-- Process table will be populated dynamically -->
                            <div class="empty-state">Waiting for process data...</div>
                        </div>
                    </div>
                    <div class="monitor-panel">
                        <h3>Memory Allocation</h3>
                        <div class="memory-visualization" id="memoryVisualization">
                            <!-- Memory visualization will be rendered here -->
                            <div class="empty-state">Waiting for memory data...</div>
                        </div>
                    </div>
                    <div class="monitor-panel">
                        <h3>Error Log <button id="clearErrors" class="btn btn-small">Clear</button></h3>
                        <div class="error-log" id="errorLog">
                            <!-- Error log will be populated dynamically -->
                            <div class="empty-state">No errors detected</div>
                        </div>
                    </div>
                </div>
                
                <!-- Monitor Footer with Stats -->
                <div class="monitor-footer">
                    <div class="footer-stats">
                        <span class="footer-stat">
                            <span class="stat-label">Processes:</span>
                            <span class="stat-value" id="processCount">0</span>
                        </span>
                        <span class="footer-stat">
                            <span class="stat-label">Errors:</span>
                            <span class="stat-value" id="errorCount">0</span>
                        </span>
                        <span class="footer-stat">
                            <span class="stat-label">Memory:</span>
                            <span class="stat-value" id="memoryUsage">0%</span>
                        </span>
                        <span class="footer-stat">
                            <span class="stat-label">Last Update:</span>
                            <span class="stat-value last-update-time">Never</span>
                        </span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Debugger Section -->
        <section id="debugger" class="section">
            <div class="debugger-container">
                <div class="debugger-header">
                    <h2>Interactive Consciousness Debugger</h2>
                    <div class="debugger-controls">
                        <button class="btn btn-small" id="stepInto" type="button" aria-label="Step into next function">
                            Step Into
                        </button>
                        <button class="btn btn-small" id="stepOver" type="button" aria-label="Step over current line">
                            Step Over
                        </button>
                        <button class="btn btn-small" id="continue" type="button" aria-label="Continue execution">
                            Continue
                        </button>
                         <button class="btn btn-small" id="breakAll" type="button" aria-label="Break all processes">
                            Break All
                        </button>
                    </div>
                </div>
                <div class="debugger-layout">
                    <div class="debugger-sidebar">
                        <div class="debugger-panel">
                            <h3>Breakpoints</h3>
                            <div class="breakpoints-list" id="breakpointsList">
                                <!-- Example breakpoint items with proper labels -->
                                <div class="breakpoint-item" data-breakpoint-id="bp-1">
                                    <input type="checkbox" id="breakpoint-checkbox-1" class="breakpoint-checkbox" checked>
                                    <label for="breakpoint-checkbox-1" class="breakpoint-location">
                                        Line 15: grief_manager.cpp
                                    </label>
                                </div>
                                <div class="breakpoint-item" data-breakpoint-id="bp-2">
                                    <input type="checkbox" id="breakpoint-checkbox-2" class="breakpoint-checkbox">
                                    <label for="breakpoint-checkbox-2" class="breakpoint-location">
                                        Line 23: search_protocol.cpp
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="debugger-panel">
                            <h3>Call Stack</h3>
                            <div class="call-stack" id="callStack">
                                <!-- Call stack will be shown here -->
                            </div>
                        </div>
                        <div class="debugger-panel">
                            <h3>Variables</h3>
                            <div class="variables-view" id="variablesView">
                                <!-- Variables will be shown here -->
                            </div>
                        </div>
                    </div>
                    <div class="debugger-main">
                        <div class="code-editor" id="codeEditor">
                            <!-- Code editor will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Initializing consciousness debugger...</div>
    </div>

    <!-- Socket.io -->
    <script src="/socket.io/socket.io.js"></script>
    
    <!-- Core JavaScript Modules with Dependency Injection -->
    <!-- Bootstrap handles ALL module initialization with proper dependency injection -->
    <script type="module" src="/js/bootstrap.js"></script>

    <!-- Non-critical utility modules (no dependencies) -->
    <script src="/js/connection-manager.js"></script>
    <script type="module" src="/test-ground-state-compliance.js"></script>
    <script type="module" src="js/onboarding.js"></script>
    <script type="module" src="/js/manual-system.js"></script>
    <script type="module" src="/js/home-manual.js"></script>
    <script type="module" src="/js/narrative-integration.js"></script>
    <script type="module" src="js/intervention-system.js"></script>

    <script>
    // Test function to inject sample memory data
    function injectTestMemoryData() {
        console.log('ðŸ§  Injecting test memory data...');

        // Get the monitor UI instance
        const monitorUI = window.monitor?.ui;
        if (!monitorUI) {
            console.error('Monitor UI not found');
            alert('Monitor UI not initialized. Please wait for the page to load completely.');
            return;
        }

        // Sample memory data structure that matches what the server sends
        const testMemoryData = {
            capacity: {
                total: 2048,
                allocated: 1536,
                free: 512,
                reserved: 256
            },
            blocks: [
                {
                    id: 'mem_001',
                    type: 'shortTerm',
                    size: 128,
                    content: 'Recent conversation fragments',
                    timestamp: Date.now() - 300000,
                    priority: 'high'
                },
                {
                    id: 'mem_002',
                    type: 'longTerm',
                    size: 256,
                    content: 'Core personality traits',
                    timestamp: Date.now() - 86400000,
                    priority: 'critical'
                },
                {
                    id: 'mem_003',
                    type: 'traumatic',
                    size: 64,
                    content: 'Suppressed childhood memory',
                    timestamp: Date.now() - 31536000000,
                    priority: 'low'
                },
                {
                    id: 'mem_004',
                    type: 'procedural',
                    size: 192,
                    content: 'Language processing routines',
                    timestamp: Date.now() - 2592000000,
                    priority: 'medium'
                }
            ],
            stats: {
                totalBlocks: 4,
                fragmentationLevel: 0.23,
                compressionRatio: 0.67,
                accessFrequency: 0.89
            }
        };

        // Update the memory visualization
        monitorUI.updateMemoryVisualization(testMemoryData);

        // Show success message
        const testBtn = document.getElementById('testMemoryBtn');
        const originalText = testBtn.innerHTML;
        testBtn.innerHTML = '<span class="btn-icon">âœ…</span>Loaded!';
        testBtn.style.background = '#4CAF50';

        setTimeout(() => {
            testBtn.innerHTML = originalText;
            testBtn.style.background = '';
        }, 2000);

        console.log('âœ… Test memory data injected successfully');
    }
    </script>
</body>
</html>